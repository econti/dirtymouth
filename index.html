
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div style="max-width:800px; margin: 0 auto">
    <h1> Just how dirty am I?</h1>
    <a id="login" class='btn btn-large btn-success'>HOW DIRTY AM I</a>
    <div id="loader">
    </div>
    <div id="chart_div">
    </div>
  </div>
  
</body>
<script>
 google.load('visualization', '1.0', {'packages':['corechart']});

var FB = null;
var messages;
var words;
var userID;

window.fbAsyncInit = function() {
  // init the FB JS SDK
  FB.init({
    appId      : '501949316569863',                        // App ID from the app dashboard
    channelUrl : 'http://localhost/channel.html', // Channel file for x-domain comms
    status     : true,                                 // Check Facebook Login status
    xfbml      : true,                                 // Look for social plugins on the page
    cookie      :true
  });
};
//herpy derp
// Load the SDK asynchronously

$("#login").click(function(){
  login();
});

(function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "https://connect.facebook.net/en_US/all.js";
   fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));
  
function getData(d) {
    var b = 100;
    var a = 6;
    for (var c = 0; c < a; c++) {
        needLoadCount++;
        FB.api(d + "&limit=" + b + "&offset=" + b * c, function (f) {
            doneLoadCount++;
            if (doneLoadCount == needLoadCount) {
                finishedLoading()
            }
            if (f.error) {
                console.log(d, f.error.message);
                return
            }
            if (!f || !f.data || !f.data.length) {
                return
            }
            var i = f.data;
            for (j = 0; j < i.length; j++) {
                var g = i[j];
                if (!g.from || g.from.id == userID) {
                    var h = g.message;
                    if (!h) {
                        h = g.name
                    }
                    if (h) {
                        addMessage(h)
                    }
                }
                var l = g.comments;
                if (!l || !l.data || !l.data.length) {
                    continue
                }
                for (var e = 0; e < l.data.length; e++) {
                    var m = l.data[e];
                    if (m.from && m.from.id == userID && m.message) {
                        addMessage(m.message)
                    }
                }
            }
        })
    }
}

function finishedLoading() {
  stopLoading();
  words = countWordsInSentences(messages);
  drawChart();
}

function countWordsInSentences(messages) {
  var words = {};
  for(var i in messages) {
    var ws = messages[i].split(" ");
    for (var i in ws) {
      var w = ws[i].toLowerCase().replace(/[^a-z]/g,"");
      if (w.length > 0) {
        if (words[w]) {
          words[w]++;
        } else {
          words[w] = 1;
        }
      }
    }
  } 
  return words;
}

function addMessage(a) {
  if (messages.length > 1000) {
      return
  }
  messages.push(a);
  if (messages.length == 200) {
      finishedLoading()
  }
}
  

function resetData() {
  messages = [];
  words = {};
  needLoadCount = 0;
  doneLoadCount = 0;
  startLoading()
}


function loadData() {
  resetData();
  getData("/me/posts?fields=message,comments.fields(from,message)");
  getData("/me/feed?fields=from,message,comments.fields(from,message)");
  getData("/me/statuses?fields=message,comments.fields(from,message)");
  getData("/me/links?fields=message,comments.fields(from,message)");
  getData("/me/checkins?fields=message,comments.fields(from,message)");
  getData("/me/photos?fields=from,name,comments.fields(from,message)")
}

function login() {
  FB.login(function (a) {
    if (a && a.status == "connected") {
      userID = a.authResponse.userID;
      loadData();
    }
  }, {
    scope: "user_status,user_photos"
  });
}

function stopLoading() {
  $("#loader").html("");
}

function startLoading() {
  $("#loader").html("<img src='http://cdn.jsdelivr.net/wp-advanced-ajax-page-loader/2.5.12/loaders/Atom%20Loading.gif'>");
}

function drawChart() {
  // Create the data table.
  var data = new google.visualization.DataTable();
  data.addColumn('string', 'word');
  data.addColumn('number', 'count');
  for(var i in words) {
    data.addRow([i,words[i]]);
  }
  // Set chart options
  var options = {'title':'Words',
   'width':800,
   'height':600};

  // Instantiate and draw our chart, passing in some options.
  var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
  chart.draw(data, options);
}

</script>
